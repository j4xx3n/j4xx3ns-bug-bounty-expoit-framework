#!/bin/bash

lfiList=""
output=""

while getopts "l:o:" opt; do
  case $opt in
    l)
      list=$OPTARG
      ;;
    o)
      output=$OPTARG
      ;;
    *)
      echo "Usage"
      echo "====="
      echo "List: $0 -l <list> -o <output>"
      exit 1
      ;;
  esac
done

# Update the github repo with payloads
cd loxs
git pull origin main

mkdir -p $output/Exploit


# Make directory for lfi scan results
mkdir -p $output/Exploir/LFI

# Clean list with urldedupe
cat $list | urldedupe | grep '=' | tee -a $output/lfiCleanList.txt


# Scan list with nuclei using lfi tags
nuclei -l $output/lfiCleanList.txt -tags lfi | tee -a $output/lfi-results.txt

# Fuzz list with ffuf
cat $output/lfiCleanList.txt | qsreplace 'FUZZ' | while read i; do ffuf -u $i -w ../loxs/payloads/lfi.txt -c -mr 'root:' | tee $output/lfiResults.txt; done

